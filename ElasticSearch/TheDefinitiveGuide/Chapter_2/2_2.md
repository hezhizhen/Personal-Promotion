## 2.2 Full-Text Search

*full-text* search: how to search within full-text fields in order to find the most relevant documents 

2 most important aspects of full-text search: 

* relevance: rank results; calculated by TF/IDF, proximity (to a geolocation), fuzzy similarity, or some other algorithm
* analysis: process of converting a block of text into distinct and normalized tokens in order to (1) create an inverted index and (2) query the inverted index
* in the territory of **queries** rather than **filters**

### 2.2.1 Term-Based Versus Full-Text

* all queries perform some sort of relevance calculation
* **NOT** all queries have an analysis phase
* specialized queries like the `bool` or `function_score` queries don't operate on text at all

textual queries can be broken down into 2 families: 

* Term-based queries
    * like `term` or `fuzzy` queries
    * low-level queries
    * have no analysis phase
    * operate on a single term
* Full-text queries
    * like `match` or `query_string` queries
    * high-level queries
    * understand the mapping of a field
        * if query a `date` field, they will treat the **query string** as a date
        * if query an exact value (`not_analyzed`) string field, they will treat the whole query string as a single term
        * if query a full-text (`analyzed`) field, they will pass the query string to produce the list of terms to be queried
    * once the query has assembled a list of terms, it executes the appropriate low-level query for each of these terms, and then combines their results to produce the final **relevance score** for each document

seldom need to use the term-based queries directly (they are used internally)

if want to use a query on an exact value `not_analyzed` field, think about:

1. do you really want a scoring query
2. if a non-scoring query might be better

**single-term queries** represent binary Y/N questions, and are better expressed as a **filter**

```elasticsearch
{
    "query": {
        "constant_score": {
            "filter": {
                "term": {
                    "gender": "female"
                }
            }
        }
    }
}
```

### 2.2.2 The match Query

* the *go-to* query
* the first query whenever need to query any field
* high-level *full-text* query
* deal with both **full-text** fields and **exact-value** fields
* the main use case is for full-text search

e.g.: a single-word query (use `match` query to search within a full-text field for a single word)

```elasticsearch
{
    "query": {
        "match": {
            "title": "QUICK!"
        }
    }
}
```

es executes the preceding match query as follows: 

1. check the field type
    * `title` field is a full-text (`analyzed`) field, so the query string should be analyzed too
2. analyze the query string
    * get a single term `quick`
    * the `match` query can be executed as a single low-level `term` query
3. find matching docs
    * `term` query looks up `quick` in the **inverted index**
    * retrieves the list of documents that contain the term
4. score each doc
    * `term` query calculates the relevance `_score` for each matching document by combining the **term frequency**, with the **the inverse document frequency**, and the **length of each field**
    * term frequency: how often `quick` appears in the `title` field of each document
    * inverse document frequency: how often `quick` appears in the `title` field in ***all*** documents in the index
    * length of each field: shorter fields are considered more relevant
